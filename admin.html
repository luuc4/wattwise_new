<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WattWise - Beta Anmeldungen</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        .admin-header {
            background: linear-gradient(135deg, #00c389 0%, #0073e6 100%);
            color: white;
            padding: 2rem 0;
        }
        .stats-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #00c389;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <h1><i class="fas fa-bolt me-2"></i>WattWise Beta Dashboard</h1>
            <p class="mb-0">Übersicht der Beta-Anmeldungen und Statistiken</p>
        </div>
    </div>

    <div class="container my-5">
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stat-number" id="totalSignups">0</div>
                    <div class="text-muted">Gesamt Anmeldungen</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stat-number" id="todaySignups">0</div>
                    <div class="text-muted">Heute</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stat-number" id="weekSignups">0</div>
                    <div class="text-muted">Diese Woche</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stat-number" id="newsletterSignups">0</div>
                    <div class="text-muted">Newsletter</div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Beta-Anmeldungen</h5>
                        <div>
                            <div class="alert alert-info mb-0" role="alert">
                                <i class="fas fa-envelope me-1"></i>
                                Beta-Anmeldungen werden per E-Mail an wattwisevorarlberg@gmail.com gesendet
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Datum</th>
                                        <th>Name</th>
                                        <th>E-Mail</th>
                                        <th>Telefon</th>
                                        <th>Newsletter</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="signupsTable">
                                    <tr>
                                        <td colspan="6" class="text-center">
                                            <div class="alert alert-info mb-0">
                                                <i class="fas fa-envelope me-2"></i>
                                                Beta-Anmeldungen werden als E-Mail-Benachrichtigungen versendet.<br>
                                                Prüfe dein E-Mail-Postfach für neue Anmeldungen.
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Tracking Statistiken</h5>
                    </div>
                    <div class="card-body">
                        <div id="trackingStats">Lade Tracking-Daten...</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Engagement Metriken</h5>
                    </div>
                    <div class="card-body">
                        <div id="engagementStats">Lade Engagement-Daten...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadSignups() {
            // Since we're using email notifications, show appropriate message
            fetch('get-signups.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show the message about email-based system
                        const tbody = document.getElementById('signupsTable');
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="6" class="text-center">
                                    <div class="alert alert-info mb-0">
                                        <i class="fas fa-envelope me-2"></i>
                                        ${data.message || 'Beta-Anmeldungen werden als E-Mail-Benachrichtigungen versendet.'}
                                    </div>
                                </td>
                            </tr>
                        `;
                        
                        // Reset stats since we don't have CSV data
                        document.getElementById('totalSignups').textContent = '-';
                        document.getElementById('todaySignups').textContent = '-';
                        document.getElementById('weekSignups').textContent = '-';
                        document.getElementById('newsletterSignups').textContent = '-';
                    }
                })
                .catch(error => {
                    console.error('Error loading signups:', error);
                    const tbody = document.getElementById('signupsTable');
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">
                                <div class="alert alert-warning mb-0">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    E-Mail-System ist aktiv. Anmeldungen werden per E-Mail gesendet.
                                </div>
                            </td>
                        </tr>
                    `;
                });
        }

        function displaySignups(signups) {
            const tbody = document.getElementById('signupsTable');
            
            if (signups.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">Keine Anmeldungen vorhanden</td></tr>';
                return;
            }

            tbody.innerHTML = signups.map(signup => `
                <tr>
                    <td>${new Date(signup.timestamp).toLocaleDateString('de-DE')}</td>
                    <td>${signup.firstName} ${signup.lastName}</td>
                    <td>${signup.email}</td>
                    <td>${signup.phone || '-'}</td>
                    <td>${signup.newsletter ? '<i class="fas fa-check text-success"></i>' : '<i class="fas fa-times text-muted"></i>'}</td>
                    <td><span class="badge bg-success">Gespeichert</span></td>
                </tr>
            `).join('');
        }

        function updateStats(signups) {
            const today = new Date().toDateString();
            const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);

            const todaySignups = signups.filter(s => new Date(s.timestamp).toDateString() === today);
            const weekSignups = signups.filter(s => new Date(s.timestamp) >= oneWeekAgo);
            const newsletterSignups = signups.filter(s => s.newsletter);

            document.getElementById('totalSignups').textContent = signups.length;
            document.getElementById('todaySignups').textContent = todaySignups.length;
            document.getElementById('weekSignups').textContent = weekSignups.length;
            document.getElementById('newsletterSignups').textContent = newsletterSignups.length;
        }

        function loadTrackingStats() {
            const clicks = JSON.parse(localStorage.getItem('wattwise_clicks') || '[]');
            const engagement = JSON.parse(localStorage.getItem('wattwise_engagement') || '[]');

            // Display tracking stats
            const trackingContainer = document.getElementById('trackingStats');
            const clickCounts = {};
            
            clicks.forEach(click => {
                clickCounts[click.action] = (clickCounts[click.action] || 0) + 1;
            });

            const trackingHTML = Object.entries(clickCounts).map(([action, count]) => 
                `<div class="d-flex justify-content-between mb-2">
                    <span>${action}</span>
                    <span class="badge bg-primary">${count}</span>
                </div>`
            ).join('');

            trackingContainer.innerHTML = trackingHTML || 'Keine Tracking-Daten verfügbar';

            // Display engagement stats
            const engagementContainer = document.getElementById('engagementStats');
            if (engagement.length > 0) {
                const avgTimeOnPage = engagement.reduce((sum, e) => sum + e.timeOnPage, 0) / engagement.length;
                const avgTimeMinutes = Math.round(avgTimeOnPage / 1000 / 60 * 100) / 100;
                
                engagementContainer.innerHTML = `
                    <div class="d-flex justify-content-between mb-2">
                        <span>Seitenaufrufe</span>
                        <span class="badge bg-info">${engagement.length}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Durchschnittliche Verweildauer</span>
                        <span class="badge bg-success">${avgTimeMinutes} Min</span>
                    </div>
                `;
            } else {
                engagementContainer.innerHTML = 'Keine Engagement-Daten verfügbar';
            }
        }

        function refreshData() {
            loadSignups();
            loadTrackingStats();
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            
            // Auto-refresh every 30 seconds
            setInterval(refreshData, 30000);
        });
    </script>
</body>
</html>